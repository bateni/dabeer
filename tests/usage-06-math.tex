\usemodule[dabeer]
\tracemathtrue

\definemathframed[graymath]
[
  frame=off,
  location=mathematics,
  background=color,
  backgroundcolor=lightgray,
  backgroundoffset=2pt
  ]

\starttext

حروفچینی متون ریاضی همواره از نِقاط قوت \TEX\ بوده است.
از آن‌جایی که \CONTEXT\ نیز در این زمینه تقریباً با \TEX\ یکسان است
نباید تفاوت چشمگیری وجود داشته باشد.
با این حال، مهم‌ترین مسئله استفاده از ارقام فارسی در فرمول‌های ریاضی است.

به عنوان مثال، می‌دانیم که مجموع $n$ عدد صحیح نخست برابر است با $n\frac{n+1}{2}$.
به عبارت دیگر،
%
\startformula
\sum_{i=1}^n i = n\frac{n+1}{2}.
\stopformula

در جهان امروز، از کودک دبستانی گرفته تا افراد میان‌سال، کیست که فرمول معروف
\eqref[eq:mc2]
را نشنیده باشد و آن را منسوب به آلبرت اینشتین نداند؟
با این وجود، تعداد آنانی که درکی از این رابطه ریاضی دارند اندک است.

\placeformula[eq:mc2]
\startformula
E = mc^2.
\stopformula

در \CONTEXT\ استفاده از قاب‌ها بسیار ساده است.
مثلاً قاب موجود در فرمول زیر به‌سادگی نشان می‌دهد که 
 $\log(1+x) = x + O(x^2)$.

\startformula
\log(1+x) = \graymath{x- \displaystyle{x^2\over2}} + {x^3 \over 3} + \cdots
\stopformula



در ادامه به یک مثال پیچیده‌تر نگاهی می‌اندازیم.

%% BUG: \subformulanumber is undefined
%% BUG or CHANGE: \formulanumber seems not to take any arguments.
%% BUG: \vfrac produces Latin digits.
\placeformula
\startformula
\leqalignno{
  c^2 &= a^2 + b^2  &\formulanumber \cr
  c &= \left(a^2 + b^2\right)^{\vfrac{1}{2}} &\formulanumber\cr  %% sub
  a^2 + b^2 &= c^2  &\formulanumber \cr  %% sub
  d^2 &= e^2        &\formulanumber\cr}
\stopformula

با استفاده از دستور \type{\mbox} می‌توان در محیط ریاضی از متن فارسی بهره برد.
\startformula
E = \{ x | \mbox{$x$ زوج است } \}.
\stopformula

یکی از زیباترین روابط ریاضی در ادامه می‌آید.
این رابطه پنج ثابت مهم ریاضیات را به یکدیگر می‌پیوندد.

\startformula
e^{i\pi} + 1 = 0.
\stopformula

برای حروفچینی عبارات چندخطی ریاضی بهتر است از \type{\startalign} بهره بگیریم.
صورت کلی برنامه خطی به شکل زیر است.

\placeformula
%\placesubformula  % does not work properly.  acts with normal formula numbering.
\startformula
\startalign[n=5,align={left,right,left,middle,right}]
\NC \min   \NC  \sum_i c_i x_i    \NC           \NC \quad \NC \NR[lp:0]
\NC \mbox{subject to }   \NC  \sum_i a_{ij} x_i \NC \geq b_j \NC \NC \forall j \NR %[+][lp:1]
\NC                      \NC  x_i               \NC \geq 0   \NC \NC \forall i \NR %[+][lp:2]
\stopalign
\stopformula

همان طور که از فلسفه \CONTEXT\ برمی‌آید،
دستور \type{\definemathalignment}
امکان تعریف عملگری برای حروفچینی برنامه‌های خطی فراهم می‌نماید.

%% TODO: inline math $$ and \m{}

%% TODO: maybe theorems, etc.

\stoptext
