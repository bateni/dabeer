\usemodule[dabeer]

%% Here we showcase several table macros and investigate what works in
%% thr RTL/Persian setting and what does.  In addition, we use the
%% two-column environment for most of the document.

%% Documentation for table mechanisms:
%% https://www.tug.org/TUGboat/tb28-3/tb90mahajan.pdf
%% https://www.tug.org/TUGboat/tb29-1/tb91mahajan.pdf
%% http://wiki.contextgarden.net/TABLE
%% http://www.pragma-ade.com/general/manuals/enattab.pdf

\definedescription[explain][alternative=serried,text=توضیح ,width=fit,distance=1ex]
\setupcolors[state=start]
\definecolor[back-1][s=0.8]
\definecolor[back-2][s=0.9]

\setuphead[section][style=bold]
%\setuptables[align=left]  %% no effect
\setupbodyfont[10pt]

\starttext

\CONTEXT\ دست‌کم چهار مکانیزم حروفچینی جداول را داراست.
ابتدا به بسته \type{table} می‌پردازیم که قدیمی‌ترین و ساده‌ترین مجموعه
برای تولید جداول کوچک است.
روش مورد توصیه هانس بسته \type{TABLE} یا \quotation{جداول طبیعی} است
که شمایلی شبیه به برچسب‌های \type{HTML} دارد و
تا حدی روده‌درازانه است.
%سه روش دیگر استفاده از 
%\type{tabulate}، %\rtlhbox{}
%\type{linetable} و
%\type{natural table}
% می‌باشد.


با استفاده از گزینه \type{direction=left}
می‌توان محیط چندستونه راست‌به‌چپ پدید آورد.

\startcolumns[n=2,tolerance=verytolerant,direction=left]  %% rule=on


\section{نوروز}
\input fa-norooz 

\leftaligned{%
\starttable[|c|c|]
\NC \REF[cB]{سال}
\NC \REF[cB]{نماد چینی}
\AR
\HL[2]
\NC ۱۳۹۰
\NC خرگوش
\AR
\NC ۱۳۹۱
\NC نهنگ
\AR
\NC ۱۳۹۲
\NC مار
\AR
\NC ۱۳۹۳
\NC اسب
\AR
\NC ۱۳۹۴
\NC گوسفند
\AR
\NC ۱۳۹۵
\NC میمون
\AR
\stoptable%
}

\explain
%
 در این‌جا از \type{starttable} استفاده نموده‌ایم.  متأسفانه به نظر
 نمی‌رسد که این ساختارِ قدیمی بتواند برای محیط‌های راست‌به‌چپ خیلی
 مناسب باشد.  از همه مهم‌تر جهت کلی جدول از چپ به راست است: یعنی به
 صورت پیش‌فرض، ستون نخست با عنوان \quotation{سال} در سمت چپ قرار
 می‌گیرد.  اما اگر کل جدول را درون محیط \type{midaligned} قرار دهیم،
 جهت‌ها به شکل منطقی در می‌آیند. جدول بالا با استفاده از
 \type{leftaligned} حروفچینی شده تا در سمت راست صفحه قرار گیرد.

\section{سکه طلا}
\input fa-coin

\stopcolumns


\section{شعر}
% source: http://ganjoor.net/vazn/
تا تاریخ هشتم بهمن‌ماه ۸۹ مجموعا
۵۱۶٬۵۴۴
 بیت شعر از طریق سایت گنجور در دسترس قرار گرفته است.
آمار بیش‌ترین ابیات موجود در سایت را در زیر مشاهده می‌نمایید.

\midaligned{%
\starttable[|c|c|r|r|]
\HL[2]
\NC \REF[cB]{ردیف}
\NC \REF[cB]{شاعر}
\NC \REF[cB]{تعداد ابیات}
\NC \REF[cB]{نسبت از کل}
\AR
\HL
\NC ۱
\NC عطار نیشابوری
\NC ۹۴٬۹۹۳
\NC ۱۸٫۳۹\٪
\AR
\NC ۲
\NC جلال‌الدین محمد مولوی
\NC ۶۵٬۹۶۷
\NC ۱۲٫۷۷\٪
\AR
\NC ۳
\NC ابوالقاسم فردوسی
\NC ۴۹٬۶۰۹
\NC ۹٫۶۰\٪
\AR
\NC ۴
\NC بیدل دهلوی
\NC ۳۲٬۳۳۳
\NC ۶٫۲۶\٪
\AR
\NC ۵
\NC نظامی گنجوی
\NC ۲۷٬۷۹۳
\NC ۵٫۳۸\٪
\AR
\NC ۶
\NC قاآنی
\NC ۲۰٬۵۵۶
\NC ۳٫۹۸\٪
%\AR
\HL[2]
\stoptable
}

\section{ریاضی}

در ریاضیات گهگاه با ثوابت غریبی مواجه می‌شویم.
اما کم‌کم آن‌ها را در فرمول‌های متعددی مشاهده می‌نماییم.

\midaligned{%
\starttable[|c|cm|cM|l|cp(4cm)|]
\NC \REF[cB]{مُبدع}
\NC \REF[cB]{ثابت} 
\NC \REF[cB]{مقدار دقیق}
\NC \REF[cB]{مقدار تقریبی} 
\NC \REF[cB]{توضیحات}
\NC  %?  It is almost necessary; never drop!
\AR
\HL  %% need more vertical space afterwards.
\NC ارشمیدس
\NC \pi \NC 3 \sum_{n=0}^{\infty}
\frac {(2n)!} {n!^2 (2n+1) 16^n}
\NC $3٫1415926\dots$ 
\NC نسبت محیط دایره به قطرش
\NC \AR
%
\NC اولر
\NC e \NC \sum_{n=0}^{\infty}
\frac 1{n!}
\NC $2٫7182818\dots$
\NC پرکاربرد در حسابان
\NC \AR
\NC اقلیدس
\NC \phi
\NC \frac{1+\sqrt 5}{2}
\NC $1٫6180339\dots$
\NC نسبت طول و عرضِ خوش‌ریخت‌ترین مستطیل!
\NC \AR
\stoptable%
}

\explain
در جدول بالا از کلیدهای \type{m} و \type{M} برای ستون‌های دوم و سوم بهره برده‌ایم.
بد نیست اندکی فاصله عمودی در بالا و پایین فرمول‌های ریاضی قرار دهیم.
بایستی دید آیا امکان انجام خودکار این امر وجود دارد یا خیر؟
%%
%%
به صورت پیش‌فرض، قلم‌های ریاضی فاقد نویسه‌های فارسی و عربی‌اند و لذا
امکان استفاده از جداساز اعشار فارسی وجود ندارد.
در این‌جا ما با استفاده از سازوکار عقب‌نشینی\LTRfootnote{fallback mechanism}
این ایراد را برطرف نموده‌ایم.
یک کاستی دیگر این مکانیزم عدم امکان تعریف جداساز اعشار فارسی برای تراز کردن اعداد آماری است.
این کار برای جداساز عادی از طریق کلیدهای \type{n} و \type{N} و برای جداساز (اروپایی) ویرگول از طریق کلیدهای \type{q} و \type{Q} شدنی است.


\section{ورزش}

در ادامه تلاش می‌کنیم از بسته جدیدتر و توصیه‌شده \type{TABLE} استفاده کنیم.

%\placetable{جدول رده‌بندی لیگ برتر ایران}
\midaligned
{%
\bTABLE  
% setups can go into bTABLE itself but it's more readable to separate them.
\setupTABLE[frame=off,offset=1mm]
\setupTABLE[column][1,2,3,4,5,6,7][align=center]
\setupTABLE[column][2][width=3cm]
%% can also use odd, even, first, last
%% other keys: toprulethickness, leftrulethickness, etc.
\setupTABLE[row][1][topframe=on,rulethickness=1pt,offset=1mm]
\setupTABLE[row][2][topframe=on,rulethickness=0.5pt,offset=1mm]
\setupTABLE[row][-1][bottomframe=on,rulethickness=1pt,offset=1mm]
\setupTABLE[row][first][background=color,backgroundcolor=back-1]
\setupTABLE[row][odd][background=color,backgroundcolor=back-2]
\bTR
 \bTH رده \eTH  \bTH تیم \eTH  \bTH برد \eTH  \bTH باخت \eTH  \bTH تساوی \eTH  \bTH تفاضل گل \eTH  \bTH امتیاز \eTH  
\eTR
\bTR \bTD ۱ \eTD \bTD استقلال \eTD
 \bTD ۱۳ \eTD  \bTD ۱۲ \eTD  \bTD ۳ \eTD  \bTD ۱۶ \eTD  \bTD ۵۱ \eTD
\eTR
\bTR \bTD ۲ \eTD \bTD استقلال خوزستان \eTD
 \bTD ۱۳ \eTD  \bTD ۱۲ \eTD  \bTD ۳ \eTD  \bTD ۱۶ \eTD  \bTD ۵۱ \eTD
 \eTR
\bTR \bTD ۳ \eTD \bTD پرسپولیس \eTD
 \bTD ۱۴\eTD  \bTD ۹ \eTD  \bTD ۵ \eTD  \bTD ۱۳ \eTD  \bTD ۵۱ \eTD
 \eTR
\bTR \bTD ۴ \eTD \bTD تراکتورسازی \eTD
 \bTD ۱۱ \eTD  \bTD ۱۲ \eTD  \bTD ۵ \eTD  \bTD ۱۰ \eTD  \bTD ۴۵ \eTD
 \eTR
\eTABLE%
}


%\startcolumns[n=2,direction=left]

\section{جغرافی}
%% https://fa.wikipedia.org/wiki/%D9%81%D9%87%D8%B1%D8%B3%D8%AA_%DA%A9%D8%B4%D9%88%D8%B1%D9%87%D8%A7_%D8%A8%D8%B1_%D9%BE%D8%A7%DB%8C%D9%87_%D9%86%D8%B1%D8%AE_%D8%A8%D9%87%D8%B1%D9%87_%D8%A8%D8%A7%D9%86%DA%A9_%D9%85%D8%B1%DA%A9%D8%B2%DB%8C

این فهرست نرخ بهره سالانه بانک مرکزی کشور ها برای بازپرداخت، سپرده
گذاری برای پرداخت وام است. امار بر اساس کتاب حقایق جهان منتشر شده است.

\midaligned%
%\placetable{بیشترین آمار ثبت‌شده تورم}%
{%
%\lefttoright  %%% BUG
\bTABLE[split=yes]
% setups can go into bTABLE itself but it's more readable to separate them.
\setupTABLE[frame=off,offset=1mm]
\setupTABLE[column][1,2,3][align=center]
\setupTABLE[column][3][alignmentcharacter={number->٫},aligncharacter=yes]
\setupTABLE[column][2][width=3cm]
%% can also use odd, even, first, last
%% other keys: toprulethickness, leftrulethickness, etc.
\setupTABLE[row][1][topframe=on,rulethickness=1pt,offset=1mm]
\setupTABLE[row][2][topframe=on,rulethickness=0.5pt,offset=1mm]
\setupTABLE[row][-1][bottomframe=on,rulethickness=1pt,offset=1mm]
\startTABLEhead
\bTR
 \bTH رتبه \eTH  \bTH کشور \eTH  \bTH درصد بهره \eTH  
\eTR
\stopTABLEhead
\bTR \bTD ۱ \eTD \bTD زیمبابوه \eTD
 \bTD ۹۷۵٫۰\٪ \eTD
\eTR
\bTR \bTD ۲ \eTD \bTD ونزوئلا \eTD
 \bTD ۲۸٫۵\٪ \eTD 
 \eTR
\bTR \bTD ۳ \eTD \bTD سائوتومه و پرنسیپ \eTD
 \bTD ۲۸٫۰\٪ \eTD  
 \eTR
\bTR \bTD ۴ \eTD \bTD ترکیه \eTD
 \bTD ۶٫۷۵\٪ \eTD
 \eTR
\bTR \bTD ۵ \eTD \bTD گینه \eTD
 \bTD ۲۲٫۲۵\٪ \eTD
 \eTR
\bTR \bTD ۶ \eTD \bTD پاراگوئه \eTD
 \bTD ۲۰\٪ \eTD
 \eTR
\bTR \bTD ۷ \eTD \bTD آنگولا \eTD
 \bTD ۱۹٫۵۷\٪ \eTD
 \eTR
\bTR \bTD ۸ \eTD \bTD کاستاریکا\eTD
 \bTD ۱۷\٪ \eTD
 \eTR
\eTABLE%
}

\explain
 اگر جدول طبیعی را در پوشش\type{\midaligned} یا دستورات مشابه
قرار دهیم، جهت راست‌به‌چپ درست می‌شود.  اما اگر آن را تنها یا درون
\type{\placetable} استفاده نماییم، جدول چپ‌به‌راست خواهد بود.
به علاوه، گزینه \type{split}
درست کار نمی‌کند.  نمی‌دانم آیا به خاطر محیط دوستونه است یا به دلیل قرار داشتن در محیط راست‌به‌چپ.

%\stopcolumns

\stoptext
